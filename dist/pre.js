import{a as w,b as _}from"./chunk-PFWPZI57.js";import{c as s,e as g}from"./chunk-UJFNRH2W.js";var e=s(g(),1),t=s(w(),1),m=s(_(),1);import r from"node:process";import d from"node:util";async function v(){let o=e.getInput("slack-bot-token")||r.env.SLACK_BOT_TOKEN,l=e.getInput("slack-ts"),a=e.getInput("slack-channel-id")||r.env.SLACK_CHANNEL_ID,$=e.getInput("status",{required:!0}),f=e.getInput("github-token",{required:!0}),c=(0,t.getOctokit)(f),b=new m.WebClient(o);if(!o)throw new Error("Missing input slack-bot-token or environment variable SLACK_BOT_TOKEN");if(l)e.saveState("slack-ts",l);else if(a){e.info(JSON.stringify({context:t.context,env:r.env},null,2));let h=await c.paginate(c.rest.actions.listJobsForWorkflowRunAttempt,{...t.context.repo,run_id:t.context.runId,attempt_number:Number.parseInt(r.env.GITHUB_RUN_ATTEMPT||"1",10)}),u=`${t.context.repo.owner}/${t.context.repo.repo}`,i=`https://github.com/${u}`,p=[{label:"Repo",url:i,value:u},{label:"Workflow",url:`${i}/actions/runs/${t.context.runId}`,value:t.context.workflow},{label:"Author",url:`https://github.com/${t.context.actor}`,value:t.context.actor}];t.context.payload.pull_request?.html_url&&p.push({label:"PR",url:t.context.payload.pull_request.html_url,value:`#${t.context.payload.pull_request.number}`});let k=await b.chat.postMessage({channel:a,text:`${t.context.workflow}`,unfurl_links:!1,attachments:[{color:"#d4ad3c",blocks:[{block_id:"info",type:"context",elements:p.map(n=>({type:"mrkdwn",text:`*${n.label}*     
<${n.url}|${n.value}>     `}))}]}]});if(!k.ts)throw new Error("Did not get slack ts");e.saveState("slack-ts",k.ts),console.log(JSON.stringify(h,null,2))}else throw new Error("missing input slack-ts or channel-id");e.saveState("start",Date.now())}v().catch(o=>{e.error(`ksmithut/slack-stream-action: ${d.format(o)}`)});export{v as run};
