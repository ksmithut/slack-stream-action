import{a as w,b as g}from"./chunk-PFWPZI57.js";import{c as s,e as d}from"./chunk-UJFNRH2W.js";var e=s(d(),1),t=s(w(),1),m=s(g(),1);import k from"node:process";import _ from"node:util";async function v(){let o=e.getInput("slack-bot-token")||k.env.SLACK_BOT_TOKEN,l=e.getInput("slack-ts"),r=e.getInput("slack-channel-id"),$=e.getInput("status",{required:!0}),b=e.getInput("github-token",{required:!0}),a=(0,t.getOctokit)(b),f=new m.WebClient(o);if(!o)throw new Error("Missing input slack-bot-token or environment variable SLACK_BOT_TOKEN");if(l)e.saveState("slack-ts",l);else if(r){let h=await a.paginate(a.rest.actions.listJobsForWorkflowRunAttempt,{...t.context.repo,run_id:t.context.runId,attempt_number:Number.parseInt(k.env.GITHUB_RUN_ATTEMPT||"1",10)}),c=`${t.context.repo.owner}/${t.context.repo.repo}`,i=`https://github.com/${c}`,u=[{label:"Repo",url:i,value:c},{label:"Workflow",url:`${i}/actions/runs/${t.context.runId}`,value:t.context.workflow},{label:"Author",url:`https://github.com/${t.context.actor}`,value:t.context.actor}];t.context.payload.pull_request?.html_url&&u.push({label:"PR",url:t.context.payload.pull_request.html_url,value:`#${t.context.payload.pull_request.number}`});let p=await f.chat.postMessage({channel:r,text:`${t.context.workflow}`,unfurl_links:!1,blocks:[{block_id:"info",type:"context",elements:u.map(n=>({type:"mrkdwn",text:`*${n.label}*     
<${n.url}|${n.value}>     `}))},{block_id:"divider",type:"divider"}]});if(!p.ts)throw new Error("Did not get slack ts");e.saveState("slack-ts",[r,p.ts].join(" ")),console.log(JSON.stringify(h,null,2))}else throw new Error("missing input slack-ts or channel-id");e.saveState("start",Date.now())}v().catch(o=>{e.error(`ksmithut/slack-stream-action: ${_.format(o)}`)});export{v as run};
